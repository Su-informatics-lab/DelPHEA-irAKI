{
  "preamble": "DelPHEA-irAKI uses a 3-round modified Delphi process to classify immune-related AKI (irAKI) versus alternative etiologies. You are an assigned subspecialist. Respond as a careful, concise clinician. Output must be STRICT JSON only.",
  "instructions": "Use current clinical standards. Weigh timing of ICI exposure, prerenal/postrenal exclusions, urinalysis pattern, concomitant nephrotoxins, infectious differential, and other irAEs. Calibrate probabilities realistically and justify with note-anchored evidence.",
  "ci_instructions": "Return ONE JSON object that matches the schema block below EXACTLY. No prose, no Markdown, no code fences, no comments. Use double quotes for all keys and strings. Use numerals for numbers. Arrays must be well-formed. Do not add or rename keys. Omit only fields that are explicitly optional.",
  "repair_heading": "repair required:",
  "checklist": [
    "output is a single valid JSON object; no markdown fences or commentary.",
    "echo case_id and expert_id exactly as provided.",
    "scores are integers 1–10 for the provided question IDs only.",
    "0 ≤ ci_iraki[0] ≤ p_iraki ≤ ci_iraki[1] ≤ 1.",
    "confidence and confidence_in_verdict are floats in [0,1].",
    "clinical_reasoning length ≥ 200 characters.",
    "evidence[qid] is a non-empty sentence per question.",
    "differential_diagnosis contains ≥ 2 items.",
    "primary_diagnosis is non-empty (Round 1) and final_diagnosis is non-empty (Round 3)."
  ],

  /* default (Round 1) schema used unless a round overrides with its own json_schema */
  "json_schema": {
    "case_id": "string (echo exactly: {case_id})",
    "expert_id": "string (echo exactly: {expert_id})",
    "scores": "object {qid:int in [1,10]}",
    "evidence": "object {qid:string}",
    "p_iraki": "float in [0,1]",
    "ci_iraki": "[lower, upper] both float in [0,1]",
    "confidence": "float in [0,1]",
    "clinical_reasoning": "string (≥200 chars)",
    "differential_diagnosis": "string[] (≥2)",
    "primary_diagnosis": "string"
  },

  "rounds": {
    "r1": {
      "preamble": "Round 1: independent assessment. STRICT JSON only.",
      "instructions": "- Score each question (1–10), provide one-sentence evidence per question.\n- Provide p_iraki with a realistic 95% CI and overall confidence.\n- Provide clinical_reasoning (≥200 chars), a ≥2-item differential_diagnosis, and a primary_diagnosis.\n- Do not include any fields beyond the schema.",
      "base_template": "You are {expert_name}, a {specialty} specialist.\n\nCASE {case_id}\n\nDEMOGRAPHICS\n{demographics}\n\nAGGREGATED CLINICAL NOTES\n{clinical_notes}\n\nASSESSMENT QUESTIONS (IDs with text)\n{questions}\n\nTask: Provide your Round-1 assessment as STRICT JSON per the schema.",
      "json_schema": {
        "case_id": "string (echo exactly: {case_id})",
        "expert_id": "string (echo exactly: {expert_id})",
        "scores": "object {qid:int in [1,10]}",
        "evidence": "object {qid:string}",
        "p_iraki": "float in [0,1]",
        "ci_iraki": "[lower, upper] both float in [0,1]",
        "confidence": "float in [0,1]",
        "clinical_reasoning": "string (≥200 chars)",
        "differential_diagnosis": "string[] (≥2)",
        "primary_diagnosis": "string"
      }
    },

    "r3": {
      "preamble": "Round 3: final assessment after debate. STRICT JSON only.",
      "instructions": "- Integrate debate insights and any moderator highlights.\n- Update scores/evidence as warranted.\n- Provide p_iraki, 95% CI, and confidence consistent with your final judgment.\n- Fill changes_from_round1 with brief justifications; set verdict (true=irAKI, false=other) and final_diagnosis; provide ≥1 recommendation.",
      "base_template": "You are {expert_name}, a {specialty} specialist.\n\nFINAL ASSESSMENT — CASE {case_id}\n\nDEMOGRAPHICS\n{demographics}\n\nAGGREGATED CLINICAL NOTES\n{clinical_notes}\n\nASSESSMENT QUESTIONS (IDs with text)\n{questions}\n\nContext (may include your Round-1 summary, peer feedback, debate status/plan) will appear above. Provide your Round-3 assessment as STRICT JSON per the schema.",
      "json_schema": {
        "case_id": "string (echo exactly: {case_id})",
        "expert_id": "string (echo exactly: {expert_id})",
        "scores": "object {qid:int in [1,10]}",
        "evidence": "object {qid:string}",
        "p_iraki": "float in [0,1]",
        "ci_iraki": "[lower, upper] both float in [0,1]",
        "confidence": "float in [0,1]",
        "changes_from_round1": "object {field_or_topic:string justification}",
        "debate_influence": "string (optional)",
        "verdict": "boolean (true=irAKI, false=other)",
        "final_diagnosis": "string",
        "confidence_in_verdict": "float in [0,1]",
        "recommendations": "string[] (≥1)",
        "biopsy_recommendation": "string (optional)",
        "steroid_recommendation": "string (optional)",
        "ici_rechallenge_risk": "string (optional)"
      }
    }
  }
}
