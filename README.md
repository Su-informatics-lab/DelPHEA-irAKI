# DelPHEA for immune-related AKI (irAKI)

**Del**phi **P**ersonalized **H**ealth **E**xplainable **A**gents for distinguishing immune-related AKI from AKI induced 
by alternative reasons
DelPHEA simulates a diverse virtual panel of medical experts conducting a modified Delphi consensus process using 
clinical notes and structured data. 


## Differential Diagnosis of AKI in Immune‑Checkpoint Inhibitor (ICI)–Treated Patients

A meaningful fraction of kidney biopsies carried out in patients on ICIs reveal lesions **unrelated to immune 
toxicity**. Misclassification exposes patients to unnecessary high‑dose steroids and interrupts life‑prolonging therapy. 
Conversely, failure to recognise **true immune‑related AKI (irAKI)** risks permanent renal damage and relapse upon 
rechallenge. The tables below summarise both sides of the ledger and map each diagnostic domain to members of our 
updated Delphi panel.

---

### 1. Alternative (Non‑immune) Causes of AKI

| Aetiology                                                       | Key bedside / laboratory clues                                                 | Panel experts with primary insight                   |
| --------------------------------------------------------------- |--------------------------------------------------------------------------------|------------------------------------------------------|
| **Pre‑renal or haemodynamic AKI**                               | Hypotension, volume depletion, low FeNa < 1 %, creatinine improves with fluids | *Nephrologist*, *Intensivist*                        |
| **Ischaemic / toxic ATN** (contrast, cisplatin, aminoglycoside) | Recent IV contrast / nephrotoxin; granular casts; bland sediment               | *Nephrologist*, *Pharmacist*, *Radiologist*          |
| **Classic drug‑induced ATIN** (PPI, NSAID, β‑lactam)            | Eosinophiluria, rash, fever; recovery after culprit stopped                    | *Nephrologist*, *Pharmacist*                         |
| **Glomerular disease & vasculitides**                           | Heavy proteinuria, dysmorphic haematuria; positive ANA/ANCA/complements        | *Pathologist*, *Rheumatologist*, *Nephrologist*      |
| **Rhabdomyolysis / pigment nephropathy**                        | CK ≫ 5 000 U L‑¹, myalgia, dark urine                                          | *Intensivist*, *Emergency Physician*, *Nephrologist* |
| **Obstructive (post‑renal) AKI**                                | Hydronephrosis or mass on imaging; relief after decompression                  | *Radiologist*, *Emergency Physician*                 |
| **Sepsis‑associated / infection‑driven AKI**                    | Fever, positive cultures, rising creatinine despite adequate MAP               | *Infectious‑Disease Specialist*, *Intensivist*       |
| **Age‑related vulnerability & polypharmacy**                    | eGFR < 45, ≥ 5 nephrotoxic meds, frailty indices, orthostatic BP drop          | *Geriatrician*, *Pharmacist*                         |

*Key takeaway → Before declaring irAKI, the panel must document volume status, recent nephrotoxin exposure, imaging, infection screen, and urinalysis findings.*

---

### 2. Immune‑Related AKI (irAKI) Attributable to ICIs

| Pathologic pattern                                                                                | Typical timing & clinical clues                                                                                                                                   | Panel experts with primary insight                    |
|---------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|
| **Acute tubulo‑interstitial nephritis (ATIN)**<br>*(≈ 70 % of biopsy‑confirmed irAKI)*            | Appears ≥ 2–16 weeks after ICI start; sterile pyuria, mild proteinuria (< 1 g day‑¹), WBC casts, eosinophiluria; often co‑occurs with other irAEs (rash, colitis) | *Oncologist*, *Nephrologist*, *Pathologist*           |
| **Glomerular lesions**<br>(MCD, membranous GN, IgA GN)                                            | Nephrotic‑range proteinuria or haematuria; biopsy shows podocytopathy or immune deposits; may lag behind other irAEs                                              | *Pathologist*, *Nephrologist*, *Rheumatologist*       |
| **Thrombotic micro‑angiopathy (TMA)**                                                             | MAHA, thrombocytopenia, rising LDH; biopsy shows endothelial swelling, double contours                                                                            | *Pathologist*, *Intensivist*, *Oncologist*            |
| **C4d‑negative antibody‑mediated rejection–like pattern** (in prior kidney‑transplant recipients) | Sudden creatinine spike in allograft, donor‑specific Ab negative; biopsy with peritubular capillaritis                                                            | *Transplant Nephrologist* (consulting), *Pathologist* |
| **Granulomatous interstitial nephritis**                                                          | Non‑caseating granulomas on biopsy; consider sarcoid‑like irAE; imaging may show mediastinal nodes                                                                | *Pathologist*, *Radiologist*, *Rheumatologist*        |
| **Immune complex tubulo‑interstitial nephritis**                                                  | Low complements, sub‑nephrotic proteinuria; biopsy with immune complex deposition                                                                                 | *Pathologist*, *Rheumatologist*                       |

**Diagnostic anchors for irAKI**

* Biopsy confirmation whenever feasible (KDIGO stage ≥ 2 or unclear aetiology).
* Association with other irAEs and ICI exposure timeline strengthens causality.
* Prompt response to high‑dose corticosteroids (1 mg kg‑¹ prednisone equiv.) supports immune aetiology, but beware of confounders (e.g., ATIN from PPI also steroid‑responsive).

---

### 3. Why the Panel Composition Matters

| Diagnostic task                                      | Critical expertise                                   |
| ---------------------------------------------------- |------------------------------------------------------|
| Exclude haemodynamic, toxic, or obstructive causes   | *Nephrologist*, *Radiologist*, *Intensivist*         |
| Interpret kidney biopsy patterns                     | *Pathologist*, *Nephrologist*                        |
| Correlate ICI dosing & timing with creatinine rise   | *Oncologist*, *Pharmacist*, *Informatician*          |
| Identify immune signatures & systemic irAEs          | *Oncologist*, *Rheumatologist*, *Nurse Practitioner* |
| Balance cancer control with renal recovery & frailty | *Oncologist*, *Geriatrician*                         |
| Rule out infection‑related AKI before steroids       | *Infectious‑Disease Specialist*, *Intensivist*       |

This structured matrix ensures every plausible mechanism—immune or otherwise—is weighed, maximising diagnostic accuracy 
and safeguarding both oncologic and renal outcomes.

## Expert Panel Specialties

1. Oncologist
2. Nephrologist
3. Pathologist
4. Pharmacist
5. Intensivist
6. Rheumatologist
7. Emergency Physician
8. Radiologist
9. Infectious Disease Specialist
10. Geriatrician
11. Nurse Practitioner


## Clinical Assessment Questions

The irAKI classification system uses 16 evidence-based questions (enhanced with peer review):

1. **Temporal Relationship**: ICI exposure timing vs. AKI onset (combination vs monotherapy patterns)
2. **Prerenal Exclusion**: Volume status, hypotension, medication effects  
3. **Postrenal Exclusion**: Obstruction, structural abnormalities
4. **Other Intrinsic Exclusion**: ATN, contrast nephropathy, other drugs
5. **Urinalysis Pattern**: Proteinuria, hematuria, cellular casts (excluding ATN patterns)
6. **Immune Activation**: Systemic inflammatory markers
7. **Concomitant Medications**: PPI, NSAID, antibiotic assessment
8. **Other irAE Correlation**: Multi-organ immune manifestations
9. **Biopsy Indication**: Expected immune-mediated pathology
10. **Treatment Response**: Clinical course and steroid response
11. **Alternative Diagnosis Exclusion**: Systematic differential assessment  
12. **Clinical Gestalt**: Overall irAKI likelihood
13. **Infection Exclusion**: Sepsis, pyelonephritis, occult infections in immunocompromised
14. **Imaging Evidence**: Radiologic patterns supporting immune vs structural causes
15. **Baseline Risk Factors**: CKD, age-related changes, frailty considerations
16. **Rechallenge Assessment**: Risk-benefit analysis for restarting ICI therapy


## System Architecture

### Modular Components

```
DelPHEA-irAKI/
├── delphea.py                 # main
├── config/
│   ├── panel.json             # expert panel configuration
│   └── questionnaire.json     # clinical assessment questions
├── search.py                  # PubMed/bioRxiv integration
├── output/                    # results and transcripts
├── demo.py                    # examples
└── requirements.txt           # dependencies
```

## Quick Start

### 1. **Installation**
```bash
# clone repository and install dependencies
pip install -r requirements.txt

# ensure AWS vLLM infrastructure is configured
export VLLM_ENDPOINT="http://172.31.11.192:8000"
```

### 2. **Basic Usage**
```bash
# health check
python delphea.py --health-check

# basic irAKI classification
python delphea.py --case-id iraki_case_001 --verbose

# with literature search
python delphea.py --case-id iraki_case_001 --enable-literature-search --verbose
```

### 3. **Example Runner**
```bash
# run basic example
python demo.py --example basic

# run with literature search
python demo.py --example with-literature

# run with custom expert panel
python demo.py --example custom-panel

# check prerequisites
python demo.py --check-prereqs
```

### 4. **Custom Configuration**
```bash
# use custom expert panel and questionnaire
python delphea.py \
  --expert-panel-config my_experts.json \
  --questionnaire-config my_questions.json \
  --case-id my_case_001
```

## Literature Search Integration

When enabled (`--enable-literature-search`), the system:

1. **Generates specialty-specific queries** for each expert
2. **Searches PubMed** for peer-reviewed literature (last 5 years)
3. **Searches bioRxiv** for recent preprints (last 2 years)  
4. **Ranks results by relevance** using irAKI-specific keywords
5. **Extracts key sentences** for clinical reasoning
6. **Integrates citations** into expert assessments

### Literature Search Example

```python
# Expert: Nephrology
Query: "immune checkpoint inhibitor acute kidney injury drug induced nephritis AKI"

# Expert: Oncology  
Query: "immune checkpoint inhibitor acute kidney injury immunotherapy toxicity irAE"

# Results integrated into clinical reasoning with citations
```

## Output for Human Review

### 1. **Consensus Results**
```json
{
  "final_consensus": {
    "iraki_probability": 0.73,
    "iraki_verdict": true,
    "consensus_confidence": 0.81,
    "expert_count": 8
  }
}
```

### 2. **Expert Assessments**
- Individual specialty perspectives with detailed reasoning
- Round 1 vs. Round 3 changes and explanations
- Literature citations (when enabled)
- Specialty-specific differential diagnoses

### 3. **Debate Transcripts**
- Question-specific disagreements and resolutions
- Expert arguments with supporting evidence
- Literature citations in debates
- Satisfaction indicators and consensus building

### 4. **Clinical Timeline**
- Immunotherapy exposure history
- AKI progression timeline
- Key clinical events and temporal relationships

## Configuration Options

### Expert Panel Customization

```bash
# full expert panel (10 experts)
--expert-panel-config config/expert_panel.json

# custom focused panel (4 experts)  
--expert-panel-config config/expert_panel_custom.json
```

### Literature Search Configuration

```bash
# enable with default settings
--enable-literature-search

# custom literature settings
--enable-literature-search \
--max-literature-results 3 \
--literature-recent-years 3 \
--literature-email "your@email.com"
```

### Assessment Configuration

```bash
# standard 12-question assessment
--questionnaire-config config/questionnaire_iraki.json

# custom question set
--questionnaire-config config/questionnaire_custom.json
```

## Development and Customization

### Adding New Expert Specialties

1. Update `config/expert_panel.json` with new expert definitions
2. Add specialty-specific keywords to `modules/literature_search.py` 
3. Update questionnaire focus areas if needed

### Modifying Assessment Questions

1. Edit `config/questionnaire_iraki.json`
2. Add clinical context and evidence criteria
3. Update scoring guidelines and decision support thresholds

### Extending Literature Search

1. Add new databases/APIs to `modules/literature_search.py`
2. Implement custom relevance scoring algorithms
3. Add specialty-specific query enhancement rules

## Clinical Research Applications

### 1. **Decision Support Development**
- Prototype for irAKI clinical decision tools
- Framework for other immune-related adverse events
- Educational tool for immunotherapy toxicity training

### 2. **Knowledge Discovery**  
- Analysis of expert reasoning patterns
- Identification of clinical decision-making processes
- Insights into specialty-specific perspectives on irAKI

### 3. **Quality Improvement**
- Standardization of irAKI assessment approaches
- Consensus development for challenging cases
- Training material for medical education

## Validation Approach

Since ground truth outcomes are not available for irAKI classification:

### 1. **Human Expert Chart Review**
- Real physicians review AI consensus decisions
- Assessment of clinical reasoning quality  
- Identification of missed considerations
- Comparison with human expert judgment

### 2. **Process Validation**
- Consistency of expert reasoning across cases
- Appropriate use of clinical evidence
- Specialty-specific contribution analysis
- Debate quality and resolution effectiveness

### 3. **Clinical Utility Assessment**
- Decision support value for clinicians
- Educational benefit for training programs
- Identification of knowledge gaps in irAKI assessment

## Future Directions

### 1. **Ground Truth Integration**
- Biopsy result correlation (when available)
- Response to immunosuppressive therapy outcomes
- Long-term renal function follow-up

### 2. **Expanded Clinical Scope**
- Other immune-related adverse events (hepatitis, pneumonitis)
- Multi-organ irAE assessment and correlation
- Treatment response prediction models

### 3. **Clinical Integration**
- Electronic health record integration
- Real-time clinical decision support
- Automated case identification and triage

### 4. **Enhanced Literature Integration**
- Real-time literature monitoring
- Guideline integration and updates
- Clinical trial result incorporation

## Contributing

This system is designed for clinical research in immune-related adverse events. 

### Research Collaboration 
- **Code/Technical**: Haining Wang (hw56@iu.edu)
- **General Questions**: Jing Su (su1@iu.edu)

## License

MIT for code. Clinical data requires appropriate institutional permissions.
